<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Playlist Viewer</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #121212; /* Dunkler Hintergrund */
      color: #ffffff; /* Helle Schriftfarbe */
      display: flex;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }

    .container {
      display: flex; /* Flexbox für das Layout */
      width: 100%; /* Volle Breite des Containers */
      max-width: 1600px; /* Maximale Breite auf 1600px erhöhen */
      height: 90vh; /* Höhe des Containers */
    }

    .left-panel {
      flex: 1; /* Links die gesamte Breite einnehmen */
      padding: 20px;
      max-height: 100%; /* Maximale Höhe für die linke Spalte */
      overflow-y: auto; /* Scrollen aktivieren */
      border-right: 1px solid #444; /* Trennlinie zwischen den Panels */
    }

    .right-panel {
      flex: 1; /* Rechts die gesamte Breite einnehmen */
      padding: 20px;
    }

    input, button {
      margin: 10px 0; /* Vertikaler Abstand */
      padding: 15px;
      font-size: 16px;
      width: 100%; /* Volle Breite */
      border: 1px solid #444;
      border-radius: 8px;
      transition: background-color 0.3s ease; /* Sanfte Animation für Hover */
    }

    input:focus {
      outline: none;
      border-color: #0073e6; /* Blauer Rand bei Fokus */
      background-color: #333; /* Dunkler Hintergrund bei Fokus */
    }

    button {
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
    }

    button:hover {
      background-color: #45a049;
    }

    #playlist-info {
      margin-top: 20px;
      text-align: left;
      max-height: 80vh; /* Maximale Höhe für Playlist-Info erhöhen */
      overflow-y: auto; /* Scrollen aktivieren, wenn die Höhe überschritten wird */
      border: 1px solid #444;
      border-radius: 8px;
      background-color: #222; /* Dunkler Hintergrund für die Playlist-Info */
      padding: 10px;
    }

    .video-item {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      padding: 10px;
      border: 1px solid #444;
      border-radius: 8px;
      transition: background-color 0.3s ease; /* Sanfte Animation für Hintergrundfarbe */
    }

    .video-item:hover {
      background-color: #333; /* Hover Farbe */
    }

    .video-item img {
      width: 100px;
      height: auto;
      border-radius: 8px;
      margin-right: 15px;
    }

    .video-item a {
      color: #0073e6;
      text-decoration: none;
      font-size: 18px;
      font-weight: bold;
    }

    .video-item a:hover {
      text-decoration: underline;
    }

    #video-player {
      max-width: 100%; /* Vollbreite */
      aspect-ratio: 16 / 9; /* 16:9 Format */
      margin-top: 20px; /* Abstand oben für Video-Player */
      border-radius: 8px;
      overflow: hidden; /* Ecken abrunden */
    }

    /* Icons für Moduswechsel */
    #mode-toggle {
      position: absolute; /* Bild oben rechts */
      top: 10px;
      right: 10px;
      width: 120px; /* Größe des Mondbildes */
      cursor: pointer;
    }

    #sun-icon {
      position: absolute; /* Bild oben rechts */
      top: 10px;
      right: 10px;
      width: 120px; /* Größe des Sonnenbildes */
      cursor: pointer;
      display: none; /* Standardmäßig ausblenden */
    }

    .error-message {
      color: red; /* Rote Farbe für Fehlermeldungen */
    }

    .loader {
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top: 4px solid #4CAF50;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 10px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="left-panel">
      <h1>YouTube Playlist ohne Werbung ansehen</h1>
      <input type="text" id="playlist-url" placeholder="YouTube-Playlist-URL eingeben" />
      <button onclick="loadPlaylist()">Playlist Laden</button>
      <div id="loader" class="loader" style="display:none;"></div> <!-- Loader anzeigen -->
      <div id="playlist-info"></div>
      <div id="error-message" class="error-message"></div> <!-- Bereich für Fehlermeldungen -->
      <div id="video-count"></div> <!-- Anzahl der geladenen Videos anzeigen -->
    </div>
    <div class="right-panel">
      <div id="video-player"></div>
      <button id="unmute-button" onclick="unmuteVideo()" style="display:none;">Ton aktivieren</button> <!-- Button für Ton aktivieren -->
    </div>
  </div>

  <!-- Icons für Moduswechsel -->
  <img id="mode-toggle" src="https://i.postimg.cc/bJpF1NS0/moon.png" alt="Toggle Mode" onclick="toggleMode()" />
  <img id="sun-icon" src="https://i.postimg.cc/y82M3HTn/sun.png" alt="Sun Icon" style="display: none;" onclick="toggleMode()" />

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let player; // Youtube-Player
    let videoIds = []; // Array für Video-IDs
    let currentVideoIndex = 0; // Aktueller Video-Index
    let isDarkMode = true; // Dunkelmodus aktiv
    const apiKey = 'AIzaSyB3FM0lIklHxh4-J52-q_kilA22L-Lfr8g'; // Hier den API-Schlüssel einfügen

    function loadPlaylist() {
      const playlistUrl = document.getElementById('playlist-url').value; // Playlist-URL abrufen
      const playlistId = extractPlaylistId(playlistUrl); // Playlist-ID extrahieren
      console.log("Playlist ID:", playlistId); // Füge dies ein, um die Playlist-ID zu protokollieren

      if (!playlistId) {
        document.getElementById('error-message').innerText = 'Bitte eine gültige Playlist-URL eingeben.';
        return;
      }

      videoIds = []; // Leere die Video-IDs
      currentVideoIndex = 0; // Setze den aktuellen Video-Index zurück
      document.getElementById('playlist-info').innerHTML = ''; // Lösche die vorherige Playlist-Info
      document.getElementById('error-message').innerText = ''; // Lösche vorherige Fehlermeldungen
      document.getElementById('loader').style.display = 'block'; // Loader anzeigen

      const maxResults = 50; // Maximal 50 Ergebnisse pro Anfrage
      let nextPageToken = ''; // Initialisiere den nächsten Seiten-Token

      // Hilfsfunktion, um die Playlist zu laden
      const fetchPlaylistItems = async (nextPageToken) => {
        const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=${maxResults}&playlistId=${playlistId}&key=${apiKey}&pageToken=${nextPageToken}`;
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error('Fehler beim Abrufen der Playlist'); // Fehler beim Abrufen der Playlist
        }
        return response.json();
      };

      // Wiederholte Anfragen, um alle Videos zu laden
      const loadAllVideos = async () => {
        try {
          let data;
          do {
            data = await fetchPlaylistItems(nextPageToken); // Anfrage an die API
            displayPlaylistInfo(data); // Playlist-Info anzeigen
            nextPageToken = data.nextPageToken; // Setze den nächsten Seiten-Token
          } while (nextPageToken); // Solange der nächste Seiten-Token vorhanden ist
        } catch (error) {
          console.error(error);
          document.getElementById('error-message').innerText = error.message; // Fehlermeldung anzeigen
        } finally {
          document.getElementById('loader').style.display = 'none'; // Loader ausblenden
          document.getElementById('video-count').innerText = `Videos geladen: ${videoIds.length}`; // Anzahl der geladenen Videos anzeigen
        }
      };

      loadAllVideos(); // Starte das Laden aller Videos
    }

    function extractPlaylistId(url) {
      const regex = /list=([^&]+)/; // Regulärer Ausdruck zur Extraktion der Playlist-ID
      const match = url.match(regex);
      return match ? match[1] : null; // Playlist-ID zurückgeben oder null
    }

    function displayPlaylistInfo(data) {
      const playlistInfoElement = document.getElementById('playlist-info');
      data.items.forEach(item => {
        const videoId = item.snippet.resourceId.videoId; // Video-ID abrufen
        const title = item.snippet.title; // Titel abrufen
        videoIds.push(videoId); // Video-ID zur Liste hinzufügen
        const thumbnailUrl = item.snippet.thumbnails?.default?.url || 'https://via.placeholder.com/100'; // Standard-Thumbnail-URL verwenden, wenn kein Thumbnail vorhanden ist
        const videoItemElement = document.createElement('div');
        videoItemElement.className = 'video-item';
        videoItemElement.innerHTML = `
          <img src="${thumbnailUrl}" alt="Thumbnail" />
          <a href="#" onclick="playVideo('${videoId}'); return false;">${title}</a>
        `;
        playlistInfoElement.appendChild(videoItemElement); // Video-Element zur Playlist-Info hinzufügen
      });
    }

    function playVideo(videoId) {
      currentVideoIndex = videoIds.indexOf(videoId); // Den aktuellen Index setzen
      loadYouTubePlayer(videoId); // Video im Player laden
    }

    function loadYouTubePlayer(videoId) {
      if (player) {
        player.loadVideoById(videoId); // Video im Player laden
      } else {
        player = new YT.Player('video-player', {
          height: '100%',
          width: '100%',
          videoId: videoId,
          playerVars: {
            'autoplay': 1,
            'controls': 1,
            'rel': 0,
            'showinfo': 0,
            'mute': 1 // Startet das Video stumm
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }
    }

    function onPlayerReady(event) {
      event.target.playVideo(); // Video abspielen, wenn der Player bereit ist
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.ENDED) {
        currentVideoIndex++;
        if (currentVideoIndex < videoIds.length) {
          loadYouTubePlayer(videoIds[currentVideoIndex]); // Nächstes Video abspielen
        }
      }
    }

    function unmuteVideo() {
      if (player) {
        player.unMute(); // Ton aktivieren
        document.getElementById('unmute-button').style.display = 'none'; // Button ausblenden
      }
    }

    function toggleMode() {
      const body = document.body;
      const modeToggleIcon = document.getElementById('mode-toggle');
      const sunIcon = document.getElementById('sun-icon');
      isDarkMode = !isDarkMode; // Modus wechseln
      if (isDarkMode) {
        body.style.backgroundColor = '#121212'; // Dunkelmodus
        modeToggleIcon.style.display = 'block'; // Mond anzeigen
        sunIcon.style.display = 'none'; // Sonne ausblenden
      } else {
        body.style.backgroundColor = '#ffffff'; // Hellmodus
        body.style.color = '#000000'; // Schriftfarbe ändern
        modeToggleIcon.style.display = 'none'; // Mond ausblenden
        sunIcon.style.display = 'block'; // Sonne anzeigen
      }
    }
  </script>
</body>
</html>
